# VPS Migration Toolkit

**VPS Migration Toolkit** ‚Äî –Ω–∞–±–æ—Ä Bash-—Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è, –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ –º–µ–∂–¥—É VPS. –°–∫—Ä–∏–ø—Ç—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –±—ã—Å—Ç—Ä–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã, –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—è —Ä—É—á–Ω–æ–π —Ç—Ä—É–¥ –∏ —Ä–∏—Å–∫–∏.

## üîç –°–æ—Å—Ç–∞–≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

- `vps_backup.sh` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- `vps_restore.sh` ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ –∏–∑ –±—ç–∫–∞–ø–∞
- `vps_migrate.sh` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ (–±—ç–∫–∞–ø + –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ + –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ + –Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
- `migrate.env_template` ‚Äî —à–∞–±–ª–æ–Ω —Ñ–∞–π–ª–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
- `movies-api.env_tempalte` ‚Äî —à–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ movies-api
- `numparser_config_tempalte.yml` ‚Äî —à–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥–∞ –¥–ª—è NUMParser
- `backups/` ‚Äî –ø–∞–ø–∫–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- `id_rsa` ‚Äî –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH-–∫–ª—é—á –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä–∞–º (–¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞

```bash
git clone https://github.com/Igorek1986/vps_migrate.git
cd vps_migrate
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
cp migrate.env_template migrate.env
nano migrate.env
```
```bash
cp movies-api.env_tempalte movies-api.env
nano movies-api.env
```
```bash
cp numparser_config_tempalte.yml numparser_config.yml
nano numparser_config.yml
```
–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (—Å–º. —Ä–∞–∑–¥–µ–ª –Ω–∏–∂–µ).

### 3. –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH-–∫–ª—é—á:
- –ü–æ–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª `id_rsa` –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞.
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∞:
```bash
chmod 600 id_rsa
```

### 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- –î–ª—è MacOS:
```bash
brew install sshpass
```
- –î–ª—è Linux:
```bash
sudo apt-get install -y sshpass
```

---

## üõ†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏

```bash
./vps_backup.sh
```
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏:
- –ë—ç–∫–∞–ø –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –≤ –ø–∞–ø–∫–µ `backups/` —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º –ø–æ –¥–∞—Ç–µ –∏ –≤—Ä–µ–º–µ–Ω–∏.
- –°—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è, –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ 3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ —Å–∫—Ä–∏–ø—Ç–µ).
- –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–ø–∏—Å–∫–∞ –±—ç–∫–∞–ø–æ–≤:
```bash
./vps_backup.sh list
  ```
- –î–ª—è —Ä—É—á–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤:
```bash
./vps_backup.sh cleanup
```

---

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ

**–í–∞—Ä–∏–∞–Ω—Ç 1 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**

```bash
./vps_restore.sh ./backups/backup_YYYYMMDD_HHMMSS
```

- IP-–∞–¥—Ä–µ—Å –∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–¥—Ç—è–Ω—É—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ `migrate.env`.
- –°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–∫–æ–ø–∏—Ä—É–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ, –Ω–∞—Å—Ç—Ä–æ–∏—Ç –ø—Ä–∞–≤–∞ –∏ –≤—ã–≤–µ–¥–µ—Ç –¥–∞–ª—å–Ω–µ–π—à–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.

- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –¥—Ä—É–≥–æ–π IP –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã:
```bash
./vps_restore.sh ./backups/backup_YYYYMMDD_HHMMSS <DEST_HOST> <NEW_USER> [NEW_USER_PASSWORD]
  ```

**–í–∞—Ä–∏–∞–Ω—Ç 2 (—Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ restore.sh –∏–∑ –ø–∞–ø–∫–∏ –±—ç–∫–∞–ø–∞):**

```bash
cd backups/backup_YYYYMMDD_HHMMSS
./restore.sh <DEST_HOST> <NEW_USER> [NEW_USER_PASSWORD]
```

---

### –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
./vps_migrate.sh
```

- –°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç –≤—Å–µ —ç—Ç–∞–ø—ã: —Å–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞, –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ, –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Å–µ—Ä–≤–∏—Å–æ–≤.
- –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ `migrate.env`.
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ "–ø–æ–¥ –∫–ª—é—á".

---

### üìå –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã
–°–∫—Ä–∏–ø—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏:

- [Antizapret](https://github.com/xtrime-ru/antizapret-vpn-docker)
- [Marzban](https://github.com/Gozargah/Marzban) ‚Äî –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VPN
- [Lampac](https://github.com/immisterio/Lampac) ‚Äî –º–µ–¥–∏–∞-–∞–≥—Ä–µ–≥–∞—Ç–æ—Ä
- [NUMParser)](ttps://github.com/Igorek1986/NUMParser) ‚Äî –ø–∞—Ä—Å–µ—Ä –¥–ª—è —Ñ–∏–ª—å–º–æ–≤ –∏ —Å–µ—Ä–∏–∞–ª–æ–≤ —Å rutor –∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º —Å TMDB (GitHub)
- [Movies API](https://github.com/Igorek1986/movies-api) ‚Äî —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–∑–¥–∞—á–∏ JSON –¥–∞–Ω–Ω—ã—Ö –æ—Ç NUMParser (GitHub)
- [3proxy](https://github.com/3proxy/3proxy) ‚Äî –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä
- [Glances](https://github.com/nicolargo/glances) ‚Äî —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–µ—Ä–≤–µ—Ä–∞


### ‚ö†Ô∏è –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
–°–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

- –û—Ç–∫–ª—é—á–∞—é—Ç –ø–∞—Ä–æ–ª—å–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è root –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –ø–æ SSH-–∫–ª—é—á—É
- –ó–∞–ø—Ä–µ—â–∞—é—Ç –≤—Ö–æ–¥ –ø–æ –ø–∞—Ä–æ–ª—é –≤ sshd_config

### ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–ú–∏–≥—Ä–∞—Ü–∏—è: Ubuntu 24.04 ‚Üí Ubuntu 24.04

–ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–æ–≤:
- MacOS (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏)
- Debian (11/12)
- Ubuntu (22.04/24.04)


### –ì–æ—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞ —Ç–æ–ª—å–∫–æ –ø–æ –∫–ª—é—á—É
```bash

DEST_HOST="1.2.3.4"
NEW_USER="user"

#Permission denied (publickey).
ssh -o PreferredAuthentications=password -o PubkeyAuthentication=no root@"$DEST_HOST"
ssh -o PreferredAuthentications=password -o PubkeyAuthentication=no "$NEW_USER"@"$DEST_HOST"

#Access is allowed
ssh root@"$DEST_HOST"
ssh "$NEW_USER"@"$DEST_HOST"
```

---

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –≤ –∫—Ä–æ–Ω

```bash
sudo touch /var/log/vps_backup.log
sudo chown user:user /var/log/vps_backup.log
sudo chmod 644 /var/log/vps_backup.log

crontab -e
  0 4 * * * /home/user/code/vps_migrate/vps_backup.sh >> /var/log/vps_backup.log 2>&1
  ```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

### migrate.env_template

–ü—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ):

```env
SOURCE_HOST=1.2.3.4         # IP –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
DEST_HOST=5.6.7.8           # IP —Ü–µ–ª–µ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
NEW_USER=user               # –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
NEW_USER_PASSWORD=password  # –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
DOMAINS_TO_UPDATE="example.com www.example.com"  # –î–æ–º–µ–Ω—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DNS
BEGET_LOGIN=your_login      # –õ–æ–≥–∏–Ω Beget –¥–ª—è DNS API
BEGET_PASSWORD=your_pass    # –ü–∞—Ä–æ–ª—å Beget –¥–ª—è DNS API
# ... –¥—Ä—É–≥–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ...
```

---

### movies-api.env_tempalte

–ü—Ä–∏–º–µ—Ä:

```env
TMDB_TOKEN='Bearer TOKEN'
RELEASES_DIR=releases
DEBUG=False
CACHE_CLEAR_PASSWORD=PASSWORD
```

---

### numparser_config_tempalte.yml

–ü—Ä–∏–º–µ—Ä:

```yaml
tmdbtoken: 'Bearer TOKEN'.
```

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- rsync
- sshpass
- git
- SSH-–∫–ª—é—á —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –æ–±–æ–∏–º —Å–µ—Ä–≤–µ—Ä–∞–º

---
